<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RomanSuite â€“ Mobil</title>
  <link rel="icon" href="data:," />
  <style>
    :root{--bg:#0f172a;--card:#111827;--muted:#9ca3af;--acc:#22d3ee;--text:#e5e7eb;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{padding:14px 16px;border-bottom:1px solid #1f2937;background:linear-gradient(180deg,#0b1222,#0f172a)}
    h1{margin:0;font-size:20px;display:flex;gap:10px;align-items:center}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{appearance:none;border:1px solid #1f2937;background:#0b1222;color:var(--text);
      padding:10px 14px;border-radius:10px;font-weight:600}
    button:disabled{opacity:.45}
    button.primary{background:#0ea5e9;border-color:#0284c7}
    .badge{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:10px;border:1px dashed #2a3344;background:#0b1222}
    .wrap{padding:14px}
    .panel{background:var(--card);border:1px solid #1f2937;border-radius:14px}
    textarea{width:100%;min-height:60vh;background:transparent;color:var(--text);border:0;resize:vertical;
      padding:14px;font-size:16px;line-height:1.55;outline:none}
    .hint{color:var(--muted);font-size:12px;margin-top:8px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
  <header>
    <h1>ğŸ“– RomanSuite <span class="badge" id="status">HazÄ±r</span></h1>
    <div class="row">
      <input id="fileInput" type="file" accept=".txt,.md" hidden>
      <button id="openBtn">ğŸ“ Dosya AÃ§</button>
      <button id="saveDocx" class="primary" disabled>â¬‡ï¸ DOCX Ä°ndir</button>
    </div>
  </header>

  <div class="wrap">
    <div class="panel">
      <textarea id="editor" placeholder="Metni buraya yaz / yapÄ±ÅŸtÄ±r..."></textarea>
    </div>
    <div class="hint">
      Ä°pucu: Yazmaya baÅŸlayÄ±nca â€œDOCX Ä°ndirâ€ otomatik aktif olur. Metni indirdiÄŸiniz dosya tÃ¼m Word (DOCX) uygulamalarÄ±nda aÃ§Ä±lÄ±r.
    </div>
  </div>

<script>
  const $ = (q)=>document.querySelector(q);
  const editor = $('#editor');
  const saveBtn = $('#saveDocx');
  const openBtn = $('#openBtn');
  const fileInput = $('#fileInput');
  const statusBadge = $('#status');

  function setStatus(txt){ statusBadge.textContent = txt; }

  function updateSaveState(){
    saveBtn.disabled = editor.value.trim().length === 0;
  }

  editor.addEventListener('input', updateSaveState);
  updateSaveState();

  // Basit .txt aÃ§ma
  openBtn.onclick = () => fileInput.click();
  fileInput.onchange = async (e) => {
    const f = e.target.files?.[0];
    if(!f) return;
    const txt = await f.text();
    editor.value = txt;
    updateSaveState();
    setStatus('Dosya yÃ¼klendi');
    setTimeout(()=>setStatus('HazÄ±r'),1200);
  };

  // XML kaÃ§Ä±ÅŸlarÄ±
  function x(s){
    return s
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;")
      .replace(/'/g,"&apos;");
  }

  // Word (DOCX) oluÅŸtur
  async function buildDocx(text){
    const zip = new JSZip();

    // --- document.xml (paragraflar) ---
    const paragraphs = text.replace(/\r\n/g,"\n").split(/\n{2,}/);
    const body = paragraphs.map(p=>{
      if(p.trim()==="") return '<w:p/>';
      // paragraf iÃ§i tek satÄ±r kÄ±rÄ±klarÄ± => w:br
      const runs = x(p).split("\n").map((line,i)=>{
        if(i===0) return `<w:r><w:t xml:space="preserve">${line}</w:t></w:r>`;
        return `<w:r><w:br/><w:t xml:space="preserve">${line}</w:t></w:r>`;
      }).join('');
      return `<w:p>${runs}</w:p>`;
    }).join('');

    const documentXml =
`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
  <w:body>
    ${body}
    <w:sectPr/>
  </w:body>
</w:document>`;

    const stylesXml =
`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:styles xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
  <w:docDefaults>
    <w:rPrDefault><w:rPr><w:sz w:val="24"/><w:szCs w:val="24"/></w:rPr></w:rPrDefault>
    <w:pPrDefault><w:pPr><w:spacing w:line="360" w:lineRule="auto"/></w:pPr></w:pPrDefault>
  </w:docDefaults>
</w:styles>`;

    const relsRels =
`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>
</Relationships>`;

    const contentTypes =
`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
  <Default Extension="xml"  ContentType="application/xml"/>
  <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>
  <Override PartName="/word/styles.xml"   ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml"/>
</Types>`;

    zip.folder('_rels').file('.rels', relsRels);
    const w = zip.folder('word');
    w.file('document.xml', documentXml);
    w.file('styles.xml', stylesXml);
    zip.file('[Content_Types].xml', contentTypes);

    const blob = await zip.generateAsync({type:'blob'});
    return blob;
  }

  // Ä°ndir
  $('#saveDocx').onclick = async () => {
    if(saveBtn.disabled) return;
    try{
      setStatus('HazÄ±rlanÄ±yorâ€¦');
      const blob = await buildDocx(editor.value || '');
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'roman.docx';
      a.click();
      URL.revokeObjectURL(a.href);
      setStatus('DOCX indirildi');
      setTimeout(()=>setStatus('HazÄ±r'),1500);
    }catch(err){
      console.error(err);
      setStatus('Hata oldu');
      alert('DOCX oluÅŸturulurken bir hata oluÅŸtu.');
    }
  };
</script>
</body>
</html>
